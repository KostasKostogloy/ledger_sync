<!doctype html>
<html lang="en">

<head>

    <title>LedgerSync - How to authenticate to NetSuite's SuiteTalk REST Web Services API - LedgerSync</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="A step-by-step guide to authenticating to the new NetSuite REST API." />
    <link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i%26display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-152343827-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-152343827-1');
    </script>

</head>

<body>

    <div id="page" class="site">
  <header id="masthead" class="site-header outer">
  <div class="inner">
    <div class="site-header-inside">
      <div class="site-branding">
        
        
        <p class="site-logo"><a href="/"><img src="/images/logo.svg" alt="LedgerSync" /></a></p>
        
      </div><!-- .site-branding -->
      
      
      <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">
        <div class="site-nav-inside">
          <button id="menu-close" class="menu-toggle"><span class="screen-reader-text">Open Menu</span><span class="icon-close" aria-hidden="true"></span></button>
          <ul class="menu">
            
            <li class="menu-item">
              
              
<a class="" href="/" >
  
  Home
  
</a>
              
            </li>
            
            <li class="menu-item">
              
              
<a class="" href="/guides/" >
  
  Guides
  
</a>
              
            </li>
            
            <li class="menu-item has-children">
              
              
<a class="" href="/reference" >
  
  Reference
  
</a>
              
                
                <ul class="submenu">
  
  <li class="menu-item">
    
    
<a class="" href="/reference/netsuite" >
  
  NetSuite REST
  
</a>
  </li>
  
  <li class="menu-item">
    
    
<a class="" href="/reference/netsuite_soap" >
  
  NetSuite SOAP
  
</a>
  </li>
  
  <li class="menu-item">
    
    
<a class="" href="/reference/quickbooks_online" >
  
  QuickBooks Online
  
</a>
  </li>
  
  <li class="menu-item">
    
    
<a class="" href="/reference/stripe" >
  
  Stripe
  
</a>
  </li>
  
</ul>

              
            </li>
            
            <li class="menu-item">
              
              
<a class="" href="/blog" >
  
  Blog
  
</a>
              
            </li>
            
            <li class="menu-item">
              
              
<a class="" href="/guides/contribute" >
  
  Contribute
  
</a>
              
            </li>
            
            <li class="menu-item menu-button">
              
              
<a class="button" href="https://github.com/LedgerSync/ledger_sync" >
  
  GitHub
  
</a>
              
            </li>
            
          </ul>
        </div><!-- .site-nav-inside -->
      </nav><!-- .site-navigation -->
      <button id="menu-open" class="menu-toggle"><span class="screen-reader-text">Close Menu</span><span class="icon-menu" aria-hidden="true"></span></button>
      
    </div><!-- .site-header-inside -->
  </div><!-- .inner -->
</header><!-- .site-header -->

  <main id="content" class="site-content">
      <article class="post post-full">
    <header class="post-header has-gradient outer">
      
      
      <div class="inner-sm">
        <div class="post-meta">
          <time class="published" datetime="2020-06-01 00:00">June 01, 2020</time>
        </div>
        <h1 class="post-title">How to authenticate to NetSuite's SuiteTalk REST Web Services API</h1>
        
        
      </div>
    </header>
    <div class="inner-md outer">
      <div class="post-content">
        <p>Earlier this year, NetSuite released their new REST API called SuiteTalk REST Web Services.  While still incomplete, this API provides a much friendlier interface for developers than its predecessors— the SOAP API and RESTlets.  We chose to use the new REST API, because we believe it is the future for building integrations to NetSuite.  The REST standard is much more intuitive, with many resources across many languages and frameworks.</p>

<div class="alert info">
    <strong>Tip:</strong> We do our best to write comprehensive unit tests for the entire library.  Tests are a great resource for examples on inputs, outputs, and usage, not all of which may be documented here.
</div>

<h2 id="options-for-authentication">Options for Authentication</h2>

<p>The REST API offers two types of authentication:  Token-Based Authentication (TBA) and OAuth 2.0.  We chose to use TBA for the REST client.</p>

<p>Simply put, TBA is based on OAuth 1.0. Ultimately, you need to generate a request header that includes a signature created using tokens retrieved from the NetSuite dashboard and the OAuth 1.0 standard.  Unfortunately, at the time of development, we hit a few walls trying to authenticate:</p>

<ul>
  <li>The NetSuite documentation was only for their SOAP API and RESTlets</li>
  <li>There were no examples in Ruby</li>
  <li>Code samples relied on libraries or packages, making it hard to understand what was actually happening under the hood.</li>
  <li>The nonce and timestamp were not defined in the inputs of examples we found, so outputs would naturally vary given that these values are meant to change in practice.</li>
  <li>There were very few examples that had both inputs and signature output to test against.</li>
</ul>

<p>In the end, the challenge of authenticating to NetSuite in the REST API was computing the signature.  No examples we found worked for us, and regardless, we needed it in Ruby.  Frustratingly, the only way to know if we were correct was to try API calls after making tweaks to our signature generation algorithm.</p>

<p>If you’re reading this post, hopefully this will save you a headache or two.  We will clearly lay out our solution, break it down step-by-step, and we will give you some real examples.  Let’s get going!</p>

<h2 id="our-solution">Our Solution</h2>

<p>Let’s start with the full solution, which can be found in the LedgerSync library class <code class="highlighter-rouge">LedgerSync::Ledgers::NetSuite::Token</code> (code can be found here).  The Token handles creating the authorization header that will be used to sign the request.  The request header looks something like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authorization: OAuth realm="TEST_REALM",oauth_consumer_key="ef40afdd8abaac111b13825dd5e5e2ddddb44f86d5a0dd6dcf38c20aae6b67e4",oauth_token="2b0ce516420110bcbd36b69e99196d1b7f6de3c6234c5afb799b73d87569f5cc",oauth_signature_method="HMAC-SHA256",oauth_timestamp="1508242306",oauth_nonce="fjaLirsIcCGVZWzBX0pg",oauth_version="1.0",oauth_signature="i7MEtGwhCTIZbTsTrNGw9LdcERn4wsjt5C7TxmKWIfU%3D"
</code></pre></div></div>

<h2 id="the-inputs">The Inputs</h2>

<p>To compute a signature, we need a few things first.  Let’s walk through each one and how to find it:</p>

<h3 id="method"><code class="highlighter-rouge">method</code></h3>

<p>The request method will be one of the following:</p>

<ul>
  <li><code class="highlighter-rouge">POST</code></li>
  <li><code class="highlighter-rouge">PUT</code></li>
  <li><code class="highlighter-rouge">PATCH</code></li>
  <li><code class="highlighter-rouge">GET</code></li>
  <li><code class="highlighter-rouge">DELETE</code></li>
</ul>

<h3 id="consumer_key-consumer_secret"><code class="highlighter-rouge">consumer_key</code>, <code class="highlighter-rouge">consumer_secret</code></h3>

<p>The consumer key and secret can be retrieved from NetSuite by creating an Integration Record.  Note that these values are only shown once at the end of creating a new Integration Record.  Once you navigate away, you will no longer be able to see these values.  You can reset the key and secret on existing Integration Records should you need to generate a new pair.</p>

<h3 id="signature_method"><code class="highlighter-rouge">signature_method</code></h3>

<p>NetSuite supports multiple signature methods.  Our library uses HMAC-SHA256.</p>

<h3 id="timestamp"><code class="highlighter-rouge">timestamp</code></h3>

<p>We need to include a current timestamp in the signature and header.</p>

<h3 id="nonce"><code class="highlighter-rouge">nonce</code></h3>

<p>We need to include a random alphanumeric string to be used in the signature and header.</p>

<h3 id="oauth_version"><code class="highlighter-rouge">oauth_version</code></h3>

<p>The OAuth Version is defaults to “1.0”</p>

<h3 id="realm"><code class="highlighter-rouge">realm</code></h3>

<p>The realm is the NetSuite account ID.  You can find this in your account or in the URL:</p>

<p><code class="highlighter-rouge">https://&lt;ACCOUNT_ID&gt;.app.netsuite.com/app/center/card.nl</code></p>

<p>If you are using a sandbox or test drive account, your account ID will include a hyphen and some other characters.  For example, it may look like this: <code class="highlighter-rouge">9876543-sb1</code>.</p>

<p>Once you have the account ID, we will need to transform it to the format the API expects.  You replace any hyphens with underscores (a.k.a. <code class="highlighter-rouge">_</code>) and capitalize all letters.  So <code class="highlighter-rouge">9876543-sb1</code> will become <code class="highlighter-rouge">9876543_SB1</code>.</p>

<h3 id="token_id-token_secret"><code class="highlighter-rouge">token_id</code>, <code class="highlighter-rouge">token_secret</code></h3>

<p>These values can be found in NetSuite when you <a href="https://system.netsuite.com/app/setup/accesstokens.nl">create an Access Token</a>.  Like the Integration Record, these values are only visible at the end of creating the token and will not be shown again.  You can also reset these values on existing Access Tokens.</p>

<h3 id="url"><code class="highlighter-rouge">url</code></h3>

<p>This is the URL of the request, which must include any query string parameters you intend to pass.</p>

<h2 id="example-values">Example Values</h2>

<p>For this guide, we will use the following values:</p>

<div class="responsive-table">
  <table>
      <caption>Input values</caption>
    <thead>
      <tr>
        <th>Variable</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>method</code></td>
        <td><code>"GET"</code></td>
      </tr>
      <tr>
        <td><code>consumer_key</code></td>
        <td><code>"CONSUMER_KEY_VALUE"</code></td>
      </tr>
      <tr>
        <td><code>consumer_secret</code></td>
        <td><code>"CONSUMER_SECRET_VALUE"</code></td>
      </tr>
      <tr>
        <td><code>signature_method</code></td>
        <td>default, <code>"HMAC-SHA256"</code></td>
      </tr>
      <tr>
        <td><code>timestamp</code></td>
        <td>Typically, you will leave this empty, but we will use <code>1234567890</code></td>
      </tr>
      <tr>
        <td><code>nonce</code></td>
        <td>Typically, you will leave this empty, but we will use <code>"asdfasdf"</code></td>
      </tr>
      <tr>
        <td><code>oauth_version</code></td>
        <td>default, <code>"1.0"</code></td>
      </tr>
      <tr>
        <td><code>realm</code></td>
        <td><code>"9876543_SB1"</code></td>
      </tr>
      <tr>
        <td><code>token_id</code></td>
        <td><code>"TOKEN_ID_VALUE"</code></td>
      </tr>
      <tr>
        <td><code>token_secret</code></td>
        <td><code>"TOKEN_SECRET_VALUE"</code></td>
      </tr>
      <tr>
        <td><code>url</code></td>
        <td><code>"https://9876543-sb1.suitetalk.api.netsuite.com/services/rest/record/v1/customer/123?expandSubResources=true"</code></td>
      </tr>
    </tbody>
  </table>
</div>

<div class="alert info">
    <strong>Note:</strong> 
The values for <code>nonce</code> and <code>timestamp</code> should be left <code>nil</code> or unpassed in practice.  They are included here for purposes of having a consistent input and output, where typically they would be generated on the fly.

</div>

<p>Throughout this tutorial, examples will appear in the following style.  You can copy and paste this code in sequence to get the same results.</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">method</span> <span class="o">=</span> <span class="s1">'GET'</span>
<span class="n">consumer_key</span> <span class="o">=</span> <span class="s1">'CONSUMER_KEY_VALUE'</span>
<span class="n">consumer_secret</span> <span class="o">=</span> <span class="s1">'CONSUMER_SECRET_VALUE'</span>
<span class="n">nonce</span> <span class="o">=</span> <span class="s1">'asdfasdf'</span>
<span class="n">oauth_version</span> <span class="o">=</span> <span class="s1">'1.0'</span>
<span class="n">realm</span> <span class="o">=</span> <span class="s1">'9876543_SB1'</span>
<span class="n">signature_method</span> <span class="o">=</span> <span class="s1">'HMAC-SHA256'</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="mi">1_234_567_890</span>
<span class="n">token_id</span> <span class="o">=</span> <span class="s1">'TOKEN_ID_VALUE'</span>
<span class="n">token_secret</span> <span class="o">=</span> <span class="s1">'TOKEN_SECRET_VALUE'</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">'https://9876543-sb1.suitetalk.api.netsuite.com/services/rest/record/v1/customer/123?expandSubResources=true'</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="generating-the-header">Generating the header</h2>

<p>Now that we have our inputs, we can walk through computing the signature and header.</p>

<p>Before we dive in, please note that many values need to be escaped.  If you see <code class="highlighter-rouge">escape(...)</code> being used below, it is shorthand for the following:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
  <span class="no">CGI</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="nf">to_s</span><span class="p">).</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/\+/</span><span class="p">,</span> <span class="s1">'%20'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now let’s walk through each step:</p>

<h3 id="1-build-data-string">1. Build data string</h3>

<p>We need to create a string that will be used to compute a digest (a.k.a. signature) from.  Using our values above, we can retrieve the string using the following:</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">token</span> <span class="o">=</span> <span class="no">LedgerSync</span><span class="o">::</span><span class="no">Ledgers</span><span class="o">::</span><span class="no">NetSuite</span><span class="o">::</span><span class="no">Token</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
  <span class="ss">method: </span><span class="nb">method</span><span class="p">,</span>
  <span class="ss">consumer_key: </span><span class="n">consumer_key</span><span class="p">,</span>
  <span class="ss">consumer_secret: </span><span class="n">consumer_secret</span><span class="p">,</span>
  <span class="ss">realm: </span><span class="n">realm</span><span class="p">,</span>
  <span class="ss">token_id: </span><span class="n">token_id</span><span class="p">,</span>
  <span class="ss">token_secret: </span><span class="n">token_secret</span><span class="p">,</span>
  <span class="ss">url: </span><span class="n">url</span>
<span class="p">)</span>

<span class="nb">puts</span> <span class="n">token</span><span class="p">.</span><span class="nf">signature_data_string</span>
</code></pre></div>    </div>
  </div>

  <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"GET&amp;https%3A%2F%2F9876543-sb1.suitetalk.api.netsuite.com%2Fservices%2Frest%2Frecord%2Fv1%2Fcustomer%2F123&amp;expandSubResources%3Dtrue%26oauth_consumer_key%3DCONSUMER_KEY_VALUE%26oauth_nonce%3Dasdfasdf%26oauth_signature_method%3DHMAC-SHA256%26oauth_timestamp%3D1234567890%26oauth_token%3DTOKEN_ID_VALUE%26oauth_version%3D1.0"</span>
</code></pre></div>  </div>

</div>

<p>But how is this created?  It is composed of three values that are escaped and joined with <code class="highlighter-rouge">&amp;</code>.  The values are as follows:</p>

<ul>
  <li><code class="highlighter-rouge">method</code>: Described in the inputs above.</li>
  <li><code class="highlighter-rouge">url_without_params</code>: The <code class="highlighter-rouge">url</code> with all query parameters removed.  In our example, this would be <code class="highlighter-rouge">https://9876543-sb1.suitetalk.api.netsuite.com/services/rest/record/v1/customer/123</code></li>
  <li><code class="highlighter-rouge">parameters_string</code>: A string representation of all URL parameters as well as the oauth parameters.</li>
</ul>

<p>Let’s dive a level deeper and look into creating the <code class="highlighter-rouge">parameters</code> string.</p>

<h3 id="1a-build-parameters-string">1a. Build parameters string</h3>

<p>The parameters string is a sorted list of key/value pairs each joined with an ampersand (<code class="highlighter-rouge">&amp;</code>).  The key/value pairs come from two sources:</p>

<ul>
  <li>Query parameters parsed out of the URL, in our case <code class="highlighter-rouge">{ "expandSubResources" =&gt; "true }</code></li>
  <li>OAuth parameters</li>
</ul>

<p>For our example, we would have the following:</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url_params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"expandSubResources"</span> <span class="o">=&gt;</span> <span class="s2">"true"</span>
<span class="p">}</span>

<span class="n">oauth_parameters_array</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">oauth_consumer_key: </span><span class="n">consumer_key</span><span class="p">,</span>
  <span class="ss">oauth_nonce: </span><span class="n">nonce</span><span class="p">,</span>
  <span class="ss">oauth_signature_method: </span><span class="n">signature_method</span><span class="p">,</span>
  <span class="ss">oauth_timestamp: </span><span class="n">timestamp</span><span class="p">,</span>
  <span class="ss">oauth_token: </span><span class="n">token_id</span><span class="p">,</span>
  <span class="ss">oauth_version: </span><span class="n">oauth_version</span>
<span class="p">}.</span><span class="nf">to_a</span>

<span class="n">parameters_string</span> <span class="o">=</span> <span class="n">url_params</span><span class="p">.</span><span class="nf">to_a</span>
                              <span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">oauth_parameters_array</span><span class="p">)</span>
                              <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="p">[</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">escape</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="p">}</span>
                              <span class="p">.</span><span class="nf">sort</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span> <span class="p">}</span>
                              <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">#{</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
                              <span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'&amp;'</span><span class="p">)</span>

<span class="nb">puts</span> <span class="n">parameters_string</span>
</code></pre></div>    </div>
  </div>

  <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"expandSubResources=true&amp;oauth_consumer_key=CONSUMER_KEY_VALUE&amp;oauth_nonce=asdfasdf&amp;oauth_signature_method=HMAC-SHA256&amp;oauth_timestamp=1234567890&amp;oauth_token=TOKEN_ID_VALUE&amp;oauth_version=1.0"</span>
</code></pre></div>  </div>

</div>

<h3 id="1b-put-it-together">1b. Put it together</h3>

<p>Now that we have our <code class="highlighter-rouge">parameters_string</code>, we can generate the following:</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url_without_params</span> <span class="o">=</span> <span class="s2">"https://9876543-sb1.suitetalk.api.netsuite.com/services/rest/record/v1/customer/123"</span>

<span class="n">signature_data_string</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nb">method</span><span class="p">,</span>
  <span class="n">escape</span><span class="p">(</span><span class="n">url_without_params</span><span class="p">),</span>
  <span class="n">escape</span><span class="p">(</span><span class="n">parameters_string</span><span class="p">)</span>
<span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s1">'&amp;'</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"GET&amp;https%3A%2F%2F9876543-sb1.suitetalk.api.netsuite.com%2Fservices%2Frest%2Frecord%2Fv1%2Fcustomer%2F123&amp;expandSubResources%3Dtrue%26oauth_consumer_key%3DCONSUMER_KEY_VALUE%26oauth_nonce%3Dasdfasdf%26oauth_signature_method%3DHMAC-SHA256%26oauth_timestamp%3D1234567890%26oauth_token%3DTOKEN_ID_VALUE%26oauth_version%3D1.0"</span>
</code></pre></div>  </div>

</div>

<h2 id="2-build-signature-key">2. Build signature key</h2>

<p>The final piece needed to generate a signature is the key.  Our key is made by joining our <code class="highlighter-rouge">consumer_secret</code> to <code class="highlighter-rouge">token_secret</code> with an ampersand (<code class="highlighter-rouge">&amp;</code>):</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">key</span> <span class="o">||=</span> <span class="p">[</span>
  <span class="n">consumer_secret</span><span class="p">,</span>
  <span class="n">token_secret</span>
<span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s1">'&amp;'</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"CONSUMER_SECRET_VALUE&amp;TOKEN_SECRET_VALUE"</span>
</code></pre></div>  </div>

</div>

<h2 id="3-compute-signature">3. Compute signature</h2>

<p>Now with our <code class="highlighter-rouge">signature_data_string</code>, we will use the desired <code class="highlighter-rouge">signature_method</code> to compute a digest.  We will assume we are using <code class="highlighter-rouge">HMAC-SHA256</code>.</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">signature</span> <span class="o">||=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">encode64</span><span class="p">(</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span>
    <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">),</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="n">signature_data_string</span>
  <span class="p">)</span>
<span class="p">).</span><span class="nf">strip</span>
</code></pre></div>    </div>
  </div>

  <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"cId0B3hP0sFVQw/gjQ/P6YiOSx76u0WfyO8umOlq3gg="</span>
</code></pre></div>  </div>

</div>

<h2 id="4-generate-header">4. Generate Header</h2>

<p>Last but not least, we can now generate our header.  The header is made by combining all of the inputs and our signature together in comma-separated, key-value pairs:</p>

<div class="example-container">
  <div class="content">
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">authorization_parts</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="ss">:realm</span><span class="p">,</span> <span class="n">realm</span><span class="p">],</span>
  <span class="p">[</span><span class="ss">:oauth_consumer_key</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">)],</span>
  <span class="p">[</span><span class="ss">:oauth_token</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">token_id</span><span class="p">)],</span>
  <span class="p">[</span><span class="ss">:oauth_signature_method</span><span class="p">,</span> <span class="n">signature_method</span><span class="p">],</span>
  <span class="p">[</span><span class="ss">:oauth_timestamp</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">],</span>
  <span class="p">[</span><span class="ss">:oauth_nonce</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">nonce</span><span class="p">)],</span>
  <span class="p">[</span><span class="ss">:oauth_version</span><span class="p">,</span> <span class="n">oauth_version</span><span class="p">],</span>
  <span class="p">[</span><span class="ss">:oauth_signature</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">signature</span><span class="p">)]</span>
<span class="p">]</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'Authorization'</span> <span class="o">=&gt;</span> <span class="s2">"OAuth </span><span class="si">#{</span><span class="n">authorization_parts</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="se">\"</span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="se">\"</span><span class="s2">"</span> <span class="si">}</span><span class="s2">.join(',')}"</span>
<span class="p">}</span>

<span class="nb">puts</span> <span class="n">headers</span>
</code></pre></div>    </div>

  </div>

  <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"Authorization"</span><span class="o">=&gt;</span><span class="s2">"OAuth realm=</span><span class="se">\"</span><span class="s2">9876543_SB1</span><span class="se">\"</span><span class="s2">,oauth_consumer_key=</span><span class="se">\"</span><span class="s2">CONSUMER_KEY_VALUE</span><span class="se">\"</span><span class="s2">,oauth_token=</span><span class="se">\"</span><span class="s2">TOKEN_ID_VALUE</span><span class="se">\"</span><span class="s2">,oauth_signature_method=</span><span class="se">\"</span><span class="s2">HMAC-SHA256</span><span class="se">\"</span><span class="s2">,oauth_timestamp=</span><span class="se">\"</span><span class="s2">1234567890</span><span class="se">\"</span><span class="s2">,oauth_nonce=</span><span class="se">\"</span><span class="s2">asdfasdf</span><span class="se">\"</span><span class="s2">,oauth_version=</span><span class="se">\"</span><span class="s2">1.0</span><span class="se">\"</span><span class="s2">,oauth_signature=</span><span class="se">\"</span><span class="s2">cId0B3hP0sFVQw%2FgjQ%2FP6YiOSx76u0WfyO8umOlq3gg%3D</span><span class="se">\"</span><span class="s2">"</span><span class="p">}</span>
</code></pre></div>  </div>

</div>

<h2 id="wrapping-up">Wrapping up</h2>

<p>All that is left is to use this header in a request.  You will need a new signature (and therefore new header) per-request.  And that’s it!</p>

<p>While not difficult in practice, it was by trial-and-error we were ultimately able to authenticate to NetSuite.  Hopefully this post saves you some time!</p>

<p>It is highly recommended that you write comprehensive unit tests for this code.  We wrote some tests in RSpec.  These test are a great resource for examples you can test against.</p>

      </div><!-- .post-content -->
    </div><!-- .inner-md -->
  </article><!-- .post -->

  <!-- Next/previous post navigation TBD -->
  <!--
  <div class="inner-md outer">
    <nav class="read-next">
      <h2 class="read-next-title line-left">Read Next</h2>
      <div class="nav-links">
        <article class="post">
          <div class="post-meta">
            <time class="published" datetime="">Previous post date</time>
          </div>
          <h3 class="post-title"><a href="#" rel="bookmark">Previous Post Title</a></h3>
        </article>
        <article class="post">
          <div class="post-meta">
            <time class="published" datetime="">Next post date</time>
          </div>
          <h3 class="post-title"><a href="#" rel="bookmark">Next Post Title</a></h3>
        </article>
      </div>
    </nav>
  </div>
  -->

  </main><!-- .site-content -->
  <footer id="colophon" class="site-footer outer">
    <div class="inner">
        <div class="site-footer-inside">
            <p class="site-info">
                 
                <span class="copyright">&copy; Modern Treasury Inc. All rights reserved.</span>   
<a class="" href="https://www.moderntreasury.com"  target="_blank" rel="noopener" >
  
  Maintained with ❤️ in San Francisco, CA by Modern Treasury
  
</a> 
            </p>
            <!-- .site-info -->
             
            <div class="social-links">
                 
<a class="" href="https://www.netlify.com"  target="_blank" rel="noopener" >
  
    <img src="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Deploys by Netlify" />
  
</a>  
<a class="button button-icon" href="https://twitter.com/ModernTreasury"  target="_blank" rel="noopener" >
  
  <span class="icon fab fa-twitter" aria-hidden="true"></span><span class="screen-reader-text">Twitter</span>
  
</a>  
<a class="button button-icon" href="https://www.linkedin.com/company/modern-treasury"  target="_blank" rel="noopener" >
  
  <span class="icon fab fa-linkedin" aria-hidden="true"></span><span class="screen-reader-text">LinkedIn</span>
  
</a>  
<a class="button button-icon" href="https://github.com/LedgerSync/ledger_sync"  target="_blank" rel="noopener" >
  
  <span class="icon fab fa-github" aria-hidden="true"></span><span class="screen-reader-text">GitHub</span>
  
</a> 
            </div>
            <!-- .social-links -->
            
        </div>
        <!-- .site-footer-inside -->
    </div>
    <!-- .inner -->
</footer>
<!-- .site-footer -->
</div><!-- .site -->

    <!-- Scripts -->
    <script src="/assets/js/plugins.js"></script>
    <script src="/assets/js/prism.js" data-manual></script>
    <script src="/assets/js/main.js"></script>
</body>

</html>